<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Smart Traffic Light: Setting Up an IoT System | Jos Zuijderwijk </title> <meta name="author" content="Jos Zuijderwijk"> <meta name="description" content="Learn how to create an IoT network for a smart traffic light."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png?c754f1480f70868e3d1156aa95244266"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://joszuijderwijk.nl/blog/traffic-light-1/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Smart Traffic Light: Setting Up an IoT System",
            "description": "Learn how to create an IoT network for a smart traffic light.",
            "published": "January 21, 2021",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Jos</span> Zuijderwijk </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/contact/">Contact </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Smart Traffic Light: Setting Up an IoT System</h1> <p>Learn how to create an IoT network for a smart traffic light.</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#introduction">Introduction</a> </div> <div> <a href="#background-the-rowing-ban-system">Background: The Rowing Ban System</a> </div> <div> <a href="#building-the-iot-network">Building the IoT Network</a> </div> <div> <a href="#"></a> </div> <ul> <li> <a href="#understanding-mqtt">Understanding MQTT</a> </li> <li> <a href="#setting-up-the-broker">Setting Up the Broker</a> </li> <li> <a href="#implementing-access-control">Implementing Access Control</a> </li> <li> <a href="#publishing-the-rowing-ban-status">Publishing the Rowing Ban Status</a> </li> </ul> <div> <a href="#conclusion-and-next-steps">Conclusion and Next Steps</a> </div> </nav> </d-contents> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/traffic-light-1-480.webp 480w,/assets/img/traffic-light-1-800.webp 800w,/assets/img/traffic-light-1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/traffic-light-1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h2 id="introduction">Introduction</h2> <p>Welcome to the first installment of our smart traffic light series! In this post, we’ll explore how to create a simple IoT network for a traffic light system. We’ll cover the basics of setting up the network, and in future posts, we’ll dive into building a <a href="../traffic-light-2">proof of concept</a> and a <a href="../traffic-light-3">full-size version</a> of our smart traffic light.</p> <h2 id="background-the-rowing-ban-system">Background: The Rowing Ban System</h2> <p>As a member of the <em>Webcie</em> at <a href="http://orcaroeien.nl" rel="external nofollow noopener" target="_blank">A.U.S.R. Orca</a>, a student rowing club, I’ve been involved in developing and maintaining the club’s websites. One of our key projects is the <em>Member Portal</em><sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>, which includes a feature for administrators to broadcast rowing bans. These bans indicate whether it’s safe or permitted to row, based on factors like weather conditions or scheduled events.</p> <p>The rowing ban status can be represented by a traffic light system:</p> <ul> <li>🟢 Green: No rowing ban</li> <li>🟠 Orange: Partial rowing ban (e.g., only single sculls allowed)</li> <li>🔴 Red: Full rowing ban (no rowing allowed)</li> </ul> <p>Our goal is to create a physical traffic light that automatically displays the current rowing ban status. This tangible representation will serve as an eye-catching and practical addition to the club’s information system.</p> <h2 id="building-the-iot-network">Building the IoT Network</h2> <p>To bring our smart traffic light to life, we need a robust infrastructure that enables communication between devices. We’ll use the <a href="https://en.wikipedia.org/wiki/MQTT" rel="external nofollow noopener" target="_blank">MQTT</a> (Message Queuing Telemetry Transport) protocol, which is ideal for IoT applications due to its lightweight nature and publish-subscribe model.</p> <h3 id="understanding-mqtt">Understanding MQTT</h3> <p>MQTT revolves around a central server called a <em>broker</em>, which manages communication between connected devices (clients). Here’s a simplified overview of our network:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/traffic-light-diagram-1-480.webp 480w,/assets/img/traffic-light-diagram-1-800.webp 800w,/assets/img/traffic-light-diagram-1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/traffic-light-diagram-1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Figure 1: Schematic overview of the IoT network. </div> <p><strong>Backend</strong>, <strong>Database</strong> and <strong>Frontend</strong> are all components of the previously mentioned member portal. The user (admin) activates a certain rowing ban by pushing a button on the frontend. This triggers an action on the backend, adding the new ban to the database. The frontend now displays the new ban that is stored in the database. These components are specific to the Orca use case and could be replaced by any other system.</p> <p>Both <strong>Traffic Light</strong> (our device) and <strong>Backend</strong> (of the member portal) are clients connected to the broker.</p> <p>MQTT uses <em>topics</em> to organize information. Clients publish messages to specific topics and subscribe to topics they want to receive messages from. For example:</p> <ul> <li>Publishing topic: <code class="language-plaintext highlighter-rouge">bans/status</code> </li> <li>Subscription topic: <code class="language-plaintext highlighter-rouge">bans/#</code> (using a wildcard to receive all messages under the “bans” topic)</li> </ul> <p>An important feature of MQTT is the option of <em>retained messages</em>. The broker can save the last message sent to a topic, ensuring new clients receive the most recent information upon connecting. This is crucial for rowing bans; otherwise the device would only be able to detect the rowing ban the moment it changes.</p> <h3 id="setting-up-the-broker">Setting Up the Broker</h3> <p>In the past I’ve been using <a href="https://www.cloudmqtt.com/" rel="external nofollow noopener" target="_blank">CloudMQTT</a> for experimenting, but they recently shut down their free plans (cheapest plan is now $5 per month). <a href="https://myqtthub.com/en" rel="external nofollow noopener" target="_blank">MyQttHub</a>, <a href="https://www.hivemq.com/" rel="external nofollow noopener" target="_blank">HiveMQ</a> and <a href="https://flespi.com/mqtt-broker" rel="external nofollow noopener" target="_blank">Flespi</a> look promising, although I’ve never used any of them.</p> <p>For our project, we’ll use <a href="https://mosquitto.org/" rel="external nofollow noopener" target="_blank">Mosquitto</a>, a popular open-source MQTT broker. While there are cloud-based options available, setting up your own broker provides more control and is cheaper in the long run. Setting up your own broker is fairly easy to do, but it requires some configuration and of course your own server.</p> <h3 id="implementing-access-control">Implementing Access Control</h3> <p>To secure our system, we’ll create three user accounts with specific permissions:</p> <ol> <li> <strong>webmaster</strong>: Admin account with full access<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup> </li> <li> <strong>ledenportaal</strong>: Account for the Member Portal</li> <li> <strong>orca</strong>: Account for client devices (e.g., the traffic light)</li> </ol> <p>We’ll use an Access Control List (ACL) to restrict these accounts. Here’s a sample ACL configuration:</p> <pre><code class="language-plain"># Admin account
user webmaster
topic readwrite #

# Member Portal account
user ledenportaal
topic readwrite vvb/status

# Client devices account
user orca
topic read vvb/status
topic write connection/#
</code></pre> <p><a href="http://www.steves-internet-guide.com/topic-restriction-mosquitto-configuration/" rel="external nofollow noopener" target="_blank">This blogpost</a> explains ACL for Mosquitto more thoroughly.</p> <h3 id="publishing-the-rowing-ban-status">Publishing the Rowing Ban Status</h3> <p>To integrate the rowing ban system with our MQTT network, we used the <a href="https://github.com/chkr1011/MQTTnet" rel="external nofollow noopener" target="_blank">MQTTnet</a> library in our ASP.NET Core backend. This allows us to publish updates to the broker whenever the rowing ban status changes.</p> <p>Remember, you could take anything as input for your traffic light! For example, the current rowing ban of your own sports club, <a href="https://kanikeenkortebroekaan" rel="external nofollow noopener" target="_blank">kanikeenkortebroekaan.nl</a>, or just hook it up to your own smart home network.</p> <h2 id="conclusion-and-next-steps">Conclusion and Next Steps</h2> <p>We’ve now laid the groundwork for our smart traffic light system by setting up an IoT network using MQTT. To recap, we’ve covered:</p> <ol> <li>The concept of using a traffic light to display rowing ban status;</li> <li>MQTT basics and network architecture;</li> <li>Setting up an MQTT broker;</li> <li>Implementing access control for security;</li> <li>Publishing rowing ban updates to the network.</li> </ol> <p>In our next post, we’ll build a prototype of the traffic light, bringing our IoT concept to life. Stay tuned!</p> <hr> <p><em>This post is part of a series on building a smart traffic light. Check out the upcoming posts for the prototype build and full-size implementation!</em></p> <hr> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1" role="doc-endnote"> <p>The member portal (“Ledenportaal”), located at <a href="mijn.orcaroeien.nl">mijn.orcaroeien.nl</a>, is a private website for members of the club. It’s used for boat reservations, articles et cetera. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:2" role="doc-endnote"> <p>With software like <a href="https://mqtt-explorer.com/" rel="external nofollow noopener" target="_blank">MQTT Explorer</a> it’s really easy to send test messages and have an overview of the traffic that goes through your broker <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"joszuijderwijk/personal-website","data-repo-id":"R_kgDOMbA9Fw","data-category":"Comments","data-category-id":"DIC_kwDOMbA9F84ChjrM","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Jos Zuijderwijk. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-projects",title:"Projects",description:"An overview of projects I&#39;ve been working on.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-contact",title:"Contact",description:"",section:"Navigation",handler:()=>{window.location.href="/contact/"}},{id:"post-smart-traffic-light-setting-up-an-iot-system",title:"Smart Traffic Light: Setting Up an IoT System",description:"Learn how to create an IoT network for a smart traffic light.",section:"Posts",handler:()=>{window.location.href="/blog/traffic-light-1/"}},{id:"post-lenker",title:"Lenker",description:"Maakt het internet malser.",section:"Posts",handler:()=>{window.location.href="/blog/lenker/"}},{id:"news-my-new-site-is-online-as-you-can-clearly-see-it-is-still-a-work-in-progress-i-am-planning-to-move-the-content-from-my-old-website-https-old-joszuijderwijk-nl-to-this-site-within-the-coming-weeks",title:"My new site is online! As you can clearly see, it is still...",description:"",section:"News"},{id:"projects-sample-project",title:"Sample project",description:"Just a sample project",section:"Projects",handler:()=>{window.location.href="/projects/first-project/"}},{id:"socials-orcid",title:"ORCID",section:"Socials",handler:()=>{window.open("https://orcid.org/0009-0008-9561-9354","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=f7SM9VYAAAAJ","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/joszuijderwijk","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/joszuijderwijk","_blank")}},{id:"socials-x",title:"X",description:"Twitter",section:"Socials",handler:()=>{window.open("https://twitter.com/joszuijderwijk","_blank")}},{id:"socials-instagram",title:"Instagram",section:"Socials",handler:()=>{window.open("https://instagram.com/joszuijderwijk","_blank")}},{id:"socials-youtube",title:"YouTube",section:"Socials",handler:()=>{window.open("https://youtube.com/@joszuijderwijk919","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>